{% extends "base.html" %}

{% block content %}
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.min.js"></script>
<div id="upxml" class="modal hide">
    <div class="modal-header">
        <button data-dismiss="modal" class="close" type="button">×</button>
        <h3>操作</h3>
    </div>
    <div class="modal-body">
        <form action="/manage/add/xmlproblem/" method="post" enctype="multipart/form-data" id="xml">
        <span id='warning'>
            <div class="row-fluid">
                <div class="span12">
                    <div class="widget-box">
                        <div class="widget-title">
                            <span class="icon">
                                <i class="icon-th-list"></i>
                            </span>
                            <h5>上传xml文件</h5>
                        </div>
                        <div class="widget-content">
                            <input width="400px" type="file" name="file" id="file"/>
                        </div>
                    </div>
                </div>
            </div>
        </span>
    </div>
    <div class="modal-footer"><button class="btn btn-primary">Confirm</button> <a data-dismiss="modal" class="btn" href="#">Cancel</a> </div>
    </form>
 </div>
<div id="content">
  <div id="content-header">
    <div id="breadcrumb"> <a href="/" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a> <a href="/manage/">Manage</a> <a href="/manage/problem/" class="current">Problem</a> </div>
  </div>
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span12">
        <div id="adpro" class="modal hide modal-test">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">×</button>
                <h3>操作</h3>
            </div>
            <div class="modal-body">
                <span id='warning'>
        <div id="all">
			<div class="container-fluid">
                <form id="problemform" action="/manage/add/problem/" method="post" enctype="multipart/form-data">
                    <input id="id_id" name="id" type="hidden"/>
                    <h1 style='text-align: center;'>题目：<input id="id_title" maxlength="50" name="title" type="text" /></h1>
                    <div class="row-fluid">
                        <div class="span3">
                            <div class="widget-box">
                                <div class="widget-title">
                                    <span class="icon">
                                        <i class="icon-th-list"></i>
                                    </span>
                                    <h5>时间限制</h5>
                                </div>
                                <div class="widget-content">
                                <input id="id_time_limit" maxlength="10" name="time_limit" type="text" />s
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <div class="widget-box">
                                <div class="widget-title">
                                    <span class="icon">
                                        <i class="icon-th-list"></i>
                                    </span>
                                    <h5>内存限制</h5>
                                </div>
                                <div class="widget-content">
                                <input id="id_memory_limit" maxlength="10" name="memory_limit" type="text" />Mb
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <div class="widget-box">
                                <div class="widget-title">
                                    <span class="icon">
                                        <i class="icon-th-list"></i>
                                    </span>
                                    <h5>难度</h5>
                                </div>
                                <div class="widget-content">
                                <input id="id_difficulty" maxlength="50" name="difficulty" type="text" />
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <div class="widget-box">
                                <div class="widget-title">
                                    <span class="icon">
                                        <i class="icon-th-list"></i>
                                    </span>
                                    <h5>来源</h5>
                                </div>
                                <div class="widget-content">
                                <input id="id_source" maxlength="50" name="source" type="text" />
                                </div>
                            </div>
                        </div>
                    </div>
				<div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>题目描述</h5>
							</div>
							<div class="widget-content">
								 <script id="id_description" name="description" style="display: inline-block;" type="text/plain" class="row-fluid">
      
 </script>
<script type="text/javascript">
    
    var id_description = UE.getEditor('id_description',{'toolbars': [['source', 'undo', 'redo', 'bold', 'italic', 'underline', 'forecolor', 'backcolor', 'superscript', 'subscript', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist', 'insertunorderedlist', 'blockquote', 'formatmatch', 'removeformat', 'autotypeset', 'inserttable', 'pasteplain', 'wordimage', 'searchreplace', 'map', 'preview', 'fullscreen'], ['insertcode', 'paragraph', 'fontfamily', 'fontsize', 'link', 'unlink', 'insertimage', 'insertvideo', 'attachment', 'emotion', 'date', 'time']], 'initialFrameWidth': '100%', 'initialFrameHeight': 100, 'serverUrl': '/ueditor/controller/?imagePathFormat=uploads%2Fimages%2F&filePathFormat=uploads%2Ffiles%2F'});
     id_description.ready(function(){
         
     });
</script>
							</div>
						</div>
					</div>
				</div>
                <div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>输入描述</h5>
							</div>
							<div class="widget-content">
								<textarea cols="40" id="id_input_description" name="input_description" rows="10" style="width:98%">
</textarea>
							</div>
						</div>
					</div>
				</div>
                <div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>输出描述</h5>
							</div>
							<div class="widget-content">
								<textarea cols="40" id="id_output_description" name="output_description" rows="10" style="width:98%">
</textarea>
							</div>
						</div>
					</div>
				</div>
                
				<div class="row-fluid">
					<div class="span6">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>输入</h5>
							</div>
							<div class="widget-content">
								<textarea cols="40" id="id_input" name="input" rows="10" style="width:97%">
</textarea>
							</div>
						</div>
					</div>
					<div class="span6">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>输出</h5>
							</div>
							<div class="widget-content">
								<textarea cols="40" id="id_output" name="output" rows="10" style="width:97%">
</textarea>
							</div>
						</div>
					</div>
				</div>
                <div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>提示</h5>
							</div>
							<div class="widget-content">
								 <script id="id_hint" name="hint" style="display: inline-block;" type="text/plain" class="row-fluid">
     
</script>
                                    <script type="text/javascript">
                                        var id_hint = UE.getEditor('id_hint',{'toolbars': [['source', 'undo', 'redo', 'bold', 'italic', 'underline', 'forecolor', 'backcolor', 'superscript', 'subscript', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist', 'insertunorderedlist', 'blockquote', 'formatmatch', 'removeformat', 'autotypeset', 'inserttable', 'pasteplain', 'wordimage', 'searchreplace', 'map', 'preview', 'fullscreen'], ['insertcode', 'paragraph', 'fontfamily', 'fontsize', 'link', 'unlink', 'insertimage', 'insertvideo', 'attachment', 'emotion', 'date', 'time']], 'initialFrameWidth': '100%', 'initialFrameHeight': 100, 'serverUrl': '/ueditor/controller/?imagePathFormat=uploads%2Fimages%2F&filePathFormat=uploads%2Ffiles%2F'});
                                         id_hint.ready(function(){
                                             
                                         });
                                    </script>
							</div>
						</div>
					</div>
				</div>
                <div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon">
									<i class="icon-th-list"></i>
								</span>
								<h5>上传测试用例</h5>
							</div>
							<div class="widget-content">
								<input width="400px" type="file" name="file" id="file"/>
							</div>
						</div>
					</div>
				</div>
	    </div>
</div>
</span>
            </div>
            <div class="modal-footer"><button class="btn btn-primary">Confirm</button> <a data-dismiss="modal" class="btn" href="#">Cancel</a> </div>
            </form>
        </div>
        <div class="widget-box">
          <div class="widget-title">
             <span class="icon"><i class="icon-th"></i></span> 
            <h5>Problems</h5>
          </div>
          <div class="widget-content nopadding">
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th width="15%">Id</th>
                  <th width="30%">题目</th>
                  <th width="15%">是否显示</th>
                  <th width="40%">操作</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style='vertical-align: middle !important; text-align: center;'>/</td>
                  <td style='vertical-align: middle !important; text-align: center;'>/</td>
                  <td style='vertical-align: middle !important; text-align: center;'>/</td>
                  <td style='vertical-align: middle !important; text-align: center;'><button id='add' value='{{ judger.id }}' href="#adpro" data-toggle="modal" class='btn'>添加</button>&nbsp;<button id='add' value='{{ judger.id }}' href="#upxml" data-toggle="modal" class='btn'>上传xml题目</button></td>
                </tr>
                {% for problem in problems %}
                <tr>
                  <td style='vertical-align: middle !important; text-align: center;'>{{ problem.id }}</td>
                  <td style='vertical-align: middle !important; text-align: center;'>{{ problem.title }}</td>
                  <td style='vertical-align: middle !important; text-align: center;'><a href="/manage/changeshow/?id={{ problem.id }}">{% if problem.visible == True %}<p style="color:green;">{{ problem.visible }}</p>{% else %}<p style="color:red;">{{ problem.visible }}</p>{% endif %}</a></td>
                  <td style='vertical-align: middle !important; text-align: center;'><button id='edit' value='{{ problem.id }}' href="#adpro" data-toggle="modal" class='btn'>编辑</button>&nbsp;<button id='rm' value='{{ problem.id }}' class='btn'>删除</button>&nbsp;<a href="/manage/downloadtest/?id={{ problem.id }}" ><button id='download' class='btn'>下载测试数据</button></a></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="/static/js/jquery.form.js"></script>
<script>
$(document).ready(function(){
    $("#add").click(function(){
        id_description.setContent("");
        id_hint.setContent("");
        $('#problemform')[0].reset();
    });
    $("[id = edit]").click(function(){
        $.post("/manage/edit/problem/",{'id':$(this).val()}, function(ret){
            ret = eval(ret);
            $("#id_title").val(ret.title);
            $("#id_time_limit").val(ret.time_limit);
            $("#id_memory_limit").val(ret.memory_limit);
            $("#id_difficulty").val(ret.difficulty);
            $("#id_source").val(ret.source);
            $("#id_input_description").val(ret.input_description);
            $("#id_output_description").val(ret.output_description);
            $("#id_input").val(ret.input);
            $("#id_output").val(ret.output);
            $("#id_id").val(ret.id);
            $("#file").val("");
            id_description.setContent(ret.description);
            id_hint.setContent(ret.hint);
        })
    });
    $('#problemform').bind('submit', function(){
        $(this).ajaxSubmit({
         success: function(data) {
                alert(data);
                if(data == '修改成功。')
                    location.reload();
                if(data == '添加成功。')
                    location.reload();
            }
       });
       return false;
    });
    $('#xml').bind('submit', function(){
        $(this).ajaxSubmit({
         success: function(data) {
                alert(data);
                location.reload();
            }
       });
       return false;
    });
    $("[id = rm]").click(function(){
        $.get("/manage/rm/problem/",{'id':$(this).val()}, function(ret){
            alert(ret);
            location.reload();
        })
    });
});
</script>
{% endblock %}
