{% extends "base.html" %}

{% block content %}
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.min.js"></script>
<div id="adpro" class="modal hide modal-test">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">×</button>
                <h3>操作</h3>
            </div>
            <div class="modal-body">
                <span id='warning'>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="accordion" id="collapse-group">
            <form action="/manage/add/contest/" method="post" id="contestform">
            <input id="id_id" name="id" type="hidden"/>
            <h1 style='text-align: center;'>标题：<input id="id_title" maxlength="50" name="title" type="text" /></h1>
                <div class="row-fluid" style="margin:5px;">
                    <div class="span3">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>开始时间</h5>
                            </div>
                            <div class="widget-content">
                                <input id="id_start_time" name="start_time" type="text" placeholder="2017-05-15 21:05" />
                            </div>
                        </div>
                    </div>
                    <div class="span3">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>结束时间</h5>
                            </div>
                            <div class="widget-content">
                                 <input id="id_end_time" name="end_time" type="text" placeholder="2017-05-15 21:15"/>
                            </div>
                        </div>
                    </div>
                    <div class="span3">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>比赛类型</h5>
                            </div>
                            <div class="widget-content">
							    <select id="id_contest_type" name="contest_type" style="width:100%;">
								    <option id="se1" value="1">公开赛</option>
								    <option id="se2" value="2">私有赛</option>
								    <option id="se3" value="3">小组赛</option>
									<option id="se4" value="4">邀请赛-小组</option>
                                    <option id="se5" value="5">邀请赛-个人</option>
						        </select>
                            </div>
                        </div>
                    </div>
                    <div class="span3">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>密码</h5>
                            </div>
                            <div class="widget-content">
                                <input id="id_password" maxlength="20" name="password" type="text" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>比赛描述</h5>
                            </div>
                            <div class="widget-content">
                                <script id="id_description" name="description" style="display: inline-block;" type="text/plain" class="row-fluid">
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>题目搜索</h5>
                            </div>
                            <div class="widget-content">
                                <select id="problemsearch" name="type" style="width:100%;">
                                    {% for problem in problems %}
								    <option>{{problem.id}} - {{problem.title}}</option>
                                    {% endfor %}
						        </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>题目</h5>
                            </div>
                            <div class="widget-content">
                                <input style="width:100%;" id="id_problems" name="problems" type="text" placeholder="用逗号隔开，例如：1,2,3,4" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>用户搜索</h5>
                            </div>
                            <div class="widget-content">
                                <select id="problemsearch" name="type" style="width:100%;">
								    {% for user in users %}
								    <option>{{user.id}} - {{user.username}}</option>
                                    {% endfor %}
						        </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>用户</h5>
                            </div>
                            <div class="widget-content">
                                <input style="width:100%;" id="id_users" name="users" type="text" placeholder="用逗号隔开，例如：1,2,3,4" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>队伍搜索</h5>
                            </div>
                            <div class="widget-content">
                                <select id="problemsearch" name="type" style="width:100%;">
								    {% for group in groups %}
								    <option>{{group.id}} - {{group.name}}</option>
                                    {% endfor %}
						        </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" style="margin:10px;">
                    <div class="span12">
                        <div class="widget-box">
                            <div class="widget-title">
                                <span class="icon">
                                    <i class="icon-th-list"></i>
                                </span>
                                <h5>队伍</h5>
                            </div>
                            <div class="widget-content">
                                <input style="width:100%;" id="id_groups" name="groups" type="text" placeholder="用逗号隔开，例如：1,2,3,4" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

                </span>
            </div>
            <div class="modal-footer"><button class="btn btn-primary">Confirm</button> <a data-dismiss="modal" class="btn" href="#">Cancel</a> </div>
            </form>
        </div>
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.min.js"></script>
<div id="content">
  <div id="content-header">
    <div id="breadcrumb"> <a href="/" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a> <a href="/manage/">Manage</a> <a href="/manage/problem/" class="current">Problem</a> </div>
  </div>
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title">
             <span class="icon"><i class="icon-th"></i></span> 
            <h5>Contests</h5>
          </div>
          <div class="widget-content nopadding">
            <table class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th width="15%">Id</th>
                  <th width="30%">标题</th>
                  <th width="40%">操作</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style='vertical-align: middle !important; text-align: center;'>/</td>
                  <td style='vertical-align: middle !important; text-align: center;'>/</td>
                  <td style='vertical-align: middle !important; text-align: center;'><button id='add' value='{{ judger.id }}' href="#adpro" data-toggle="modal" class='btn'>添加</button></td>
                </tr>
                {% for contest in contests %}
                <tr>
                  <td style='vertical-align: middle !important; text-align: center;'>{{ contest.id }}</td>
                  <td style='vertical-align: middle !important; text-align: center;'>{{ contest.title }}</td>
                  <td style='vertical-align: middle !important; text-align: center;'><button id='edit' value='{{ contest.id }}' href="#adpro" data-toggle="modal" class='btn'>编辑</button>&nbsp;<button id='rm' value='{{ contest.id }}' class='btn'>删除</button></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="/static/js/jquery.form.js"></script>
<script>
$(document).ready(function(){
    var id_description = UE.getEditor('id_description',{'toolbars': [['source', 'undo', 'redo', 'bold', 'italic', 'underline', 'forecolor', 'backcolor', 'superscript', 'subscript', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist', 'insertunorderedlist', 'blockquote', 'formatmatch', 'removeformat', 'autotypeset', 'inserttable', 'pasteplain', 'wordimage', 'searchreplace', 'map', 'preview', 'fullscreen'], ['insertcode', 'paragraph', 'fontfamily', 'fontsize', 'link', 'unlink', 'insertimage', 'insertvideo', 'attachment', 'emotion', 'date', 'time']], 'initialFrameWidth': '100%', 'initialFrameHeight': 100, 'serverUrl': '/ueditor/controller/?imagePathFormat=uploads%2Fimages%2F&filePathFormat=uploads%2Ffiles%2F'});
    id_description.ready(function(){});
    $("#add").click(function(){
        $('#contestform')[0].reset();
        id_description.setContent("");
    });
    $("[id = edit]").click(function(){
        $.post("/manage/edit/contest/",{'id':$(this).val()}, function(ret){
            ret = eval(ret);
            $("#id_id").val(ret.id);
            $("#id_title").val(ret.title);
            $("#id_start_time").val(ret.start_time);
            $("#id_end_time").val(ret.end_time);
            $("#id_contest_type").val(ret.contest_type);
            $("#id_contest_type").find("option[text='" + ret.contest_type + "']").attr("selected",true);
            $("#id_password").val(ret.password);
            $("#id_problems").val(ret.problem);
            $("#id_users").val(ret.user);
            $("#id_groups").val(ret.group);
            id_description.setContent(ret.description);
        })
    });
    $('#contestform').bind('submit', function(){
        $(this).ajaxSubmit({
         success: function(data) {
                alert(data);
                if(data == '修改成功。')
                    location.reload();
                if(data == '添加成功。')
                    location.reload();
            }
       });
       return false;
    });
    $("[id = rm]").click(function(){
        $.get("/manage/rm/contest/",{'id':$(this).val()}, function(ret){
            alert(ret);
            location.reload();
        })
    });
});
</script>
{% endblock %}
